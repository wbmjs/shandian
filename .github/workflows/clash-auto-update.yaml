name: ğŸ”„ Auto Update Clash Config

on:
  # æ¯å¤© UTC 0:00 è§¦å‘ï¼ˆå³åŒ—äº¬æ—¶é—´ 8:00ï¼‰
  schedule:
    - cron: '0 0 * * *'
  # å…è®¸åœ¨ Actions é¡µé¢æ‰‹åŠ¨è¿è¡Œ
  workflow_dispatch:

jobs:
  update-clash-config:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›ï¸ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸŒ Fetch Clash config from Railway
        run: |
          echo "Fetching Clash config from Railway..."
          curl -f -s -o clash_auto.yaml "https://wyx-production.up.railway.app/clash"
          if [ ! -s clash_auto.yaml ]; then
            echo "âŒ Error: Empty or invalid response from Railway"
            exit 1
          fi
          echo "âœ… Config fetched successfully"

      - name: ğŸ“¤ Commit and push if changed
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add clash_auto.yaml
          # Only commit if there are changes
          if ! git diff --staged --quiet; then
            git commit -m "ğŸ”„ Auto-update Clash config [$(date -u)]"
            git push
            echo "âœ… Changes pushed"
          else
            echo "â„¹ï¸ No changes detected"
          fi
